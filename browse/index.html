---
layout: default
title: Charity graph - multi-root BFS & taxpayer totals
---
<script src="../expose/jquery.min.js"></script>
<script>let nodes=[],edges=[];</script><!-- work aroudn for crash with vis.js -->
<!-- Viz.js (core + full render) -->
<script src="../expose/viz.js"></script>
<script src="../expose/full.render.js"></script>

<!-- svg-pan-zoom for panning/zooming the resulting SVG -->
<script src="../expose/svg-pan-zoom.min.js"></script>

<!-- JSZip for reading the zipped CSVs -->
<script src="../expose/jszip.min.js"></script>

<!-- Papa Parse for CSV parsing -->
<script src="../expose/papaparse.min.js"></script>
    <script src="../expose/d3.v7.min.js"></script>
    <script src="./d3-sankey.js"></script>
    <script type="module" src="script.js"></script>


<style>
  #activeEINs, #activeFilters {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5em;
  }

  #graph-container {
    overflow: hidden; /* Hide scrollbars */
  }
#control-panel {
    background: #f9f9f9;
    border: 1px solid #ddd;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    padding: 15px;
    width: 300px;
    font-family: Arial, sans-serif;
}

#control-panel h3 {
    margin-top: 0;
    font-size: 16px;
}

#control-panel p {
    margin: 5px 0;
    font-size: 14px;
}

#control-panel button {
    margin-right: 5px;
    margin-top: 5px;
    padding: 5px 10px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 3px;
    cursor: pointer;
}

.disabled button {
    margin-right: 5px;
    margin-top: 5px;
    padding: 5px 10px;
    background: #007bff;
    color: red;
    border: red;
    border-radius: 3px;
    cursor: pointer;
}


#control-panel button:hover {
    background: #0056b3;
}

.node.selected path {
    stroke: #ff0000;
    stroke-width: 2px;
}

.link.selected {
    stroke: #ff0000 !important;
    stroke-width: 3px !important;
}


</style>

<div id="topbar" class="">
  <div id="explanation">
    <h1 class="mb-1">Charity graph</h1>
    <!-- If custom_graph is present, we show "title" or "Displaying exact graph." below -->
    <p id="instructions" class="opacity-80 mb-0 text-[15px]">
      <!-- Will be dynamically set in parseQueryParams() -->
    </p>
    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const returnUrl = urlParams.get('return_url');
      if (returnUrl) {
        document.write(`<div class="mt-1 mb-2"><button class="frameless" onclick="window.location.href='${returnUrl}'">&larr; Back to officer search</button></div>`);
      }
    </script>
    
    <!-- "How it works" toggle is BFS-only -->
    <button class="frameless mb-2 text-base bfs-only" id="howItWorksBtn">How it works</button>
    <div class="h-[0px] overflow-hidden transition-all duration-200 bfs-only" id="howItWorksList">
      <div class="p-4 border border-gray-200 rounded-md bg-white">
        <h3 class="mt-0">How it works</h3>
        <ol class="!list-decimal space-y-1 text-sm pl-4">
        <li>We show NGOs and the money that flows between them.</li>
        <li>Octogons (aka stop sign) are NGOs that don't have any outflows to other NGOs.</li>
        <li>Gray "plus" circles roll up grants to keep the graph from being overwhelming, click to see 3 more.</li>
       <li> Jump Start <a href="/browse/?ein=521344831&ein=521943638&ein=521527835&ein=521338892&ein=521398742&ein=521340267&ein=943027761">NED Hydra!</a></a>
       <li> Jump Start <a href="/browse/?ein=001">Root of all Evil!</a></li>
       <li> Jump Start <a href="/browse/?ein=110303001">Fidelity Aid</a></li>
       <li> Jump Start <a href="/browse/?ein=800835023">Turning Point</a></li>
       <li> Jump Start <a href="/browse/?ein=831567380">Bill Kriston's NGO</a></li>
       <li> Jump Start <a href="/browse/?ein=943240841">AIDS VACCINE ADVOCACY COALITION INC.</a></li>


       </ol>
      </div>
    </div>
  </div>
   <!-- BFS controls are BFS-only -->
  <div id="controls" class="mt-2 mb-4 flex flex-col @xl:items-start @xl:justify-between @xl:flex-row gap-4 bfs-only">
    <!-- EIN Input & Add Button -->
     <div class="relative flex flex-col gap-2 max-w-lg">
      {% include input.html 
        label="Add EIN(s)" 
        id="einShowInput" 
        placeholder="XX-XXXXXXX or 9 digits" 
        buttonLabel="Add EIN" 
        buttonId="addEinBtn" 
        actions="<button id='clearEINsBtnShow' class='frameless'>Clear EINs</button>"
      %}

      <div id="activeEINs"></div>
    </div>
    <div class="relative flex flex-col gap-2 max-w-lg">
      {% include input.html 
        label="Remove EIN(s)" 
        id="einHIdeInput" 
        placeholder="XX-XXXXXXX or 9 digits" 
        buttonLabel="Remove EIN" 
        buttonId="hideEinBtn" 
        actions="<button id='clearEINsBtnHide' class='frameless'>Clear EINs</button>"
      %}

      <div id="hideEINs"></div>
    </div>

    <div class="relative flex flex-col gap-2 max-w-lg">
      {% include input.html 
        label="Add keyword" 
        id="keywordInput" 
        placeholder="Keyword or phrase..." 
        buttonLabel="Add" 
        buttonId="addFilterBtn"
        actions="<button id='clearFiltersBtn' class='frameless'>Clear keywords</button>"
      %}

      <div id="activeFilters"></div>
    </div>

    <div class="flex-1 text-right flex flex-row-reverse md:flex-col items-end justify-between md:justify-end gap-1 md:self-end">
      <!-- <button id="generateBtn">Generate Graph</button> -->
      <button id="downloadBtn" class="frameless" style="display: none;">
        <span class="flex items-center gap-1 text-sm text-gray-500 font-semibold">
          <img src="/assets/images/download.svg" class="size-5" alt="Download SVG">
          Download SVG
        </span>
      </button>
      <div id="status" class=""></div>
    </div>
  </div>
</div>

<div id="excluded-info" class="-mx-4 md:mx-0 mb-4 px-3 pt-3 pb-2 flex gap-4 md:gap-8 md:rounded border-y md:border-x border-gray-200 bg-white" style="display: none;">
  {% include stat.html label="501(c)(3)s <em>not</em> displayed" valueId="excluded501" %}
  {% include stat.html label="Grants <em>not</em> displayed" valueId="excludedGrants" %}
  {% include stat.html label="<strong class='font-semibold'>Taxpayer total in subgraph</strong>" labelColor="text-red opacity-100" valueId="taxpayerTotal" %}
</div>

<div class="relative flex-1 -mx-4 md:mx-0 min-h-[75vh]">

  <!-- Search -->
  <div class="absolute top-4 left-4 md:left-[initial] right-4 z-10">
    <div class="relative">
      <input 
        type="text" 
        id="searchInput"
        class="w-full md:w-64 px-2 py-2 md:py-1 text-sm border border-gray-300 rounded-sm shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        placeholder="Search graph..."
        autocomplete="off"
      >
      <button 
        id="clearSearch" 
        class="absolute right-2 top-1/2 -translate-y-1/2 min-w-0 p-1 aspect-square items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 hidden"
        aria-label="Clear search"
      >
        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="black" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
      <div id="searchResults" class="absolute w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg hidden">
        <!-- Results will be populated here -->
      </div>
    </div>
  </div>


<!-- Zoom Controls -->
<div class="absolute bottom-4 right-4 z-10 flex flex-col gap-1">
  <button id="zoomIn" class="p-2 rounded min-w-0 bg-black/60 hover:bg-black">
    <svg class="w-5 h-5" fill="none" stroke="black" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
    </svg>
  </button>
  <button id="zoomOut" class="p-2 rounded min-w-0 bg-black/60 hover:bg-black">
    <svg class="w-5 h-5" fill="none" stroke="black" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
    </svg>
  </button>
  <button id="zoomFit" class="p-2 rounded min-w-0 bg-black/60 hover:bg-black">
    <svg class="w-5 h-5" fill="none" stroke="black" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-5V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"/>
    </svg>
  </button>
</div>

<div class="absolute bottom-4 right-16 z-10 flex flex-col gap-1">
  <button id="scaleUp" class="p-2 rounded min-w-0 bg-black/60 hover:bg-black">
    <svg class="w-5 h-5" fill="none" stroke="black" viewBox="0 0 24 24">
              <path d="M12.0,12.0 L12.11,12.01 L12.21,12.04
      L12.3,12.09 L12.39,12.17 L12.47,12.25 L12.53,12.36
      L12.57,12.48 L12.59,12.61 L12.59,12.75 L12.57,12.89
      L12.53,13.04 L12.46,13.19 L12.37,13.33 L12.25,13.46
      L12.11,13.59 L11.95,13.7 L11.77,13.79 L11.57,13.86
      L11.35,13.91 L11.12,13.93 L10.88,13.92 L10.63,13.89
      L10.37,13.82 L10.12,13.72 L9.87,13.59 L9.64,13.42
      L9.41,13.22 L9.2,13.0 L9.01,12.74 L8.85,12.45 L8.71,12.14
      L8.61,11.8 L8.54,11.45 L8.51,11.08 L8.52,10.7 L8.57,10.31
      L8.67,9.92 L8.81,9.53 L9.0,9.15 L9.23,8.79 L9.5,8.44
      L9.82,8.12 L10.17,7.82 L10.57,7.56 L10.99,7.33 L11.45,7.15
      L11.94,7.01 L12.45,6.93 L12.97,6.89 L13.5,6.91 L14.05,6.99
      L14.58,7.13 L15.12,7.32 L15.64,7.57 L16.14,7.88 L16.61,8.25
      L17.05,8.67 L17.45,9.14 L17.81,9.66 L18.11,10.22
      L18.36,10.82 L18.56,11.45 L18.68,12.11 L18.74,12.79
      L18.74,13.48 L18.65,14.18 L18.5,14.88 L18.27,15.57
      L17.97,16.23 L17.6,16.88 L17.16,17.49 L16.65,18.06
      L16.07,18.59 L15.44,19.06 L14.76,19.46 L14.03,19.81
      L13.25,20.07 L12.45,20.26 L11.61,20.37 L10.76,20.4
      L9.91,20.34 L9.05,20.18 L8.2,19.95 L7.37,19.62 L6.57,19.2
      L5.81,18.7 L5.09,18.12 L4.43,17.46 L3.83,16.73 L3.3,15.94
      L2.85,15.08 L2.48,14.18 L2.21,13.23 L2.03,12.25"
      stroke="black" stroke-width=".75" fill="none" />
  </button>
  <button id="scaleDown" class="p-2 rounded min-w-0 bg-black/60 hover:bg-black">
    <svg class="w-5 h-5" fill="none" stroke="black" viewBox="0 0 24 24">
         <path d="M12.0,12.0 L12.03,12.0 L12.06,12.01
         L12.09,12.03 L12.12,12.05 L12.14,12.08 L12.16,12.11 L12.17,12.14
         L12.18,12.18 L12.18,12.22 L12.17,12.27 L12.16,12.31 L12.14,12.36
         L12.11,12.4 L12.08,12.44 L12.03,12.48 L11.99,12.51 L11.93,12.54
         L11.87,12.56 L11.8,12.57 L11.74,12.58 L11.66,12.58 L11.59,12.57
         L11.51,12.55 L11.44,12.52 L11.36,12.48 L11.29,12.43 L11.22,12.37
         L11.16,12.3 L11.1,12.22 L11.05,12.13 L11.01,12.04 L10.98,11.94
         L10.96,11.83 L10.95,11.72 L10.96,11.61 L10.97,11.49 L11.0,11.38
         L11.04,11.26 L11.1,11.15 L11.17,11.04 L11.25,10.93 L11.34,10.83
         L11.45,10.75 L11.57,10.67 L11.7,10.6 L11.84,10.55 L11.98,10.5
         L12.13,10.48 L12.29,10.47 L12.45,10.47 L12.61,10.5 L12.78,10.54
         L12.94,10.6 L13.09,10.67 L13.24,10.76 L13.38,10.87 L13.51,11.0
         L13.63,11.14 L13.74,11.3 L13.83,11.47 L13.91,11.65 L13.97,11.84
         L14.01,12.03 L14.02,12.24 L14.02,12.45 L14.0,12.65 L13.95,12.86
         L13.88,13.07 L13.79,13.27 L13.68,13.46 L13.55,13.65 L13.39,13.82
         L13.22,13.98 L13.03,14.12 L12.83,14.24 L12.61,14.34 L12.38,14.42
         L12.13,14.48 L11.88,14.51 L11.63,14.52 L11.37,14.5 L11.11,14.46
         L10.86,14.38 L10.61,14.29 L10.37,14.16 L10.14,14.01 L9.93,13.84
         L9.73,13.64 L9.55,13.42 L9.39,13.18 L9.25,12.92 L9.15,12.65
         L9.06,12.37 L9.01,12.07 L8.98,11.77 L8.99,11.47 L9.03,11.16
         L9.1,10.86 L9.2,10.56 L9.33,10.27 L9.49,9.99 L9.68,9.73
         L9.9,9.48 L10.14,9.26 L10.41,9.06 L10.7,8.89 L11.01,8.74
         L11.33,8.63 L11.67,8.55 L12.02,8.5 L12.37,8.49 L12.72,8.51
         L13.08,8.57 L13.43,8.66 L13.77,8.8 L14.1,8.96 L14.41,9.16
         L14.71,9.4 L14.98,9.66 L15.22,9.95 L15.44,10.27 L15.63,10.61
         L15.78,10.97 L15.89,11.35 L15.97,11.74 L16.01,12.13 L16.01,12.54
         L15.96,12.94 L15.88,13.34 L15.76,13.74 L15.59,14.12 L15.39,14.49
         L15.14,14.83 L14.87,15.16 L14.56,15.45 L14.22,15.72 L13.85,15.95
         L13.45,16.15 L13.04,16.3 L12.61,16.41 L12.17,16.49 L11.72,16.51
         L11.26,16.49 L10.81,16.43 L10.36,16.32 L9.93,16.16 L9.5,15.96
         L9.1,15.71 L8.72,15.43 L8.37,15.1 L8.05,14.75 L7.77,14.35
         L7.53,13.93 L7.33,13.49 L7.17,13.02 L7.06,12.54 L7.0,12.04
         L6.99,11.54 L7.03,11.03 L7.12,10.53 L7.26,10.04 L7.46,9.56
         L7.69,9.1 L7.98,8.67 L8.31,8.26 L8.68,7.89 L9.09,7.55 L9.54,7.25
         L10.01,7.0 L10.51,6.8 L11.03,6.64 L11.57,6.54 L12.12,6.49
         L12.67,6.5 L13.22,6.57 L13.77,6.68 L14.3,6.86 L14.82,7.09
         L15.32,7.37 L15.78,7.7 L16.22,8.07 L16.61,8.5 L16.97,8.96
         L17.27,9.45 L17.53,9.98 L17.74,10.54 L17.89,11.11 L17.98,11.7
         L18.01,12.3 L17.98,12.91 L17.89,13.51 L17.74,14.1 L17.53,14.67
         L17.26,15.23 L16.94,15.76 L16.56,16.25 L16.14,16.71 L15.66,17.13
         L15.15,17.5 L14.6,17.81 L14.01,18.07 L13.41,18.27 L12.78,18.41
         L12.13,18.49 L11.48,18.5 L10.83,18.45 L10.18,18.33 L9.55,18.15
         L8.93,17.9 L8.34,17.59 L7.78,17.22 L7.26,16.8 L6.78,16.32
         L6.34,15.8 L5.97,15.23 L5.64,14.62 L5.38,13.98 L5.19,13.32
         L5.06,12.63 L5.0,11.94 L5.01,11.24 L5.09,10.53 L5.24,9.84
         L5.46,9.17 L5.75,8.51 L6.1,7.89 L6.51,7.3 L6.99,6.75 L7.52,6.25
         L8.1,5.8 L8.72,5.42 L9.39,5.09 L10.08,4.84 L10.8,4.65
         L11.54,4.53 L12.29,4.49 L13.04,4.53 L13.79,4.64 L14.52,4.82
         L15.24,5.08 L15.93,5.41 L16.59,5.81 L17.2,6.28 L17.77,6.8
         L18.29,7.39 L18.75,8.02 L19.14,8.7 L19.46,9.42 L19.71,10.17
         L19.89,10.95 L19.99,11.74 L20.0,12.54 L19.94,13.34 L19.8,14.14
         L19.58,14.91 L19.28,15.67 L18.9,16.4 L18.45,17.08 L17.93,17.72
         L17.35,18.31 L16.72,18.84 L16.02,19.3 L15.29,19.7 L14.51,20.02
         L13.71,20.26 L12.88,20.42 L12.03,20.5 L11.18,20.49 L10.33,20.4
         L9.49,20.22 L8.67,19.96 L7.88,19.61 L7.12,19.19 L6.4,18.69
         L5.74,18.12 L5.14,17.49 L4.6,16.79 L4.13,16.04 L3.73,15.25
         L3.42,14.41 L3.19,13.55 L3.05,12.67 L2.99,11.77 L3.03,10.87
         L3.16,9.97 L3.37,9.09 L3.68,8.23 L4.07,7.4 L4.54,6.61 L5.09,5.87
         L5.72,5.19 L6.41,4.57 L7.16,4.03 L7.97,3.55 L8.82,3.16
         L9.71,2.86 L10.63,2.65 L11.57,2.52 L12.52,2.5 L13.47,2.56
         L14.42,2.73 L15.34,2.99 L16.24,3.34 L17.1,3.78 L17.91,4.3
         L18.67,4.91 L19.37,5.59 L20.0,6.34 L20.56,7.15 L21.03,8.01
         L21.41,8.92 L21.7,9.87 L21.9,10.85 L21.99,11.84" stroke="black"
         stroke-width=".75" fill="none" />    
    </svg>
  </svg>
  </button>
  <button id="scaleReset" class="p-2 rounded min-w-0 bg-black/60 hover:bg-black">
    <svg class="w-5 h-5" fill="none" stroke="black" viewBox="0 0 24 24">
              <path d="M12.0,12.0 L12.05,12.01 L12.1,12.02
      L12.15,12.05 L12.2,12.08 L12.23,12.13 L12.26,12.18
      L12.28,12.24 L12.3,12.3 L12.3,12.37 L12.29,12.45
      L12.26,12.52 L12.23,12.59 L12.18,12.66 L12.13,12.73
      L12.06,12.79 L11.98,12.85 L11.88,12.89 L11.78,12.93
      L11.67,12.95 L11.56,12.96 L11.44,12.96 L11.31,12.94
      L11.19,12.91 L11.06,12.86 L10.94,12.79 L10.82,12.71
      L10.71,12.61 L10.6,12.5 L10.51,12.37 L10.42,12.22
      L10.36,12.07 L10.31,11.9 L10.27,11.72 L10.26,11.54
      L10.26,11.35 L10.29,11.15 L10.34,10.96 L10.41,10.77
      L10.5,10.58 L10.61,10.39 L10.75,10.22 L10.91,10.06
      L11.09,9.91 L11.28,9.78 L11.5,9.67 L11.73,9.58 L11.97,9.51
      L12.22,9.46 L12.48,9.45 L12.75,9.46 L13.02,9.5 L13.29,9.56
      L13.56,9.66 L13.82,9.79 L14.07,9.94 L14.3,10.12
      L14.52,10.33 L14.72,10.57 L14.9,10.83 L15.06,11.11
      L15.18,11.41 L15.28,11.73 L15.34,12.06 L15.37,12.4
      L15.37,12.74 L15.33,13.09 L15.25,13.44 L15.14,13.78
      L14.99,14.12 L14.8,14.44 L14.58,14.75 L14.32,15.03
      L14.04,15.29 L13.72,15.53 L13.38,15.73 L13.01,15.9
      L12.63,16.04 L12.22,16.13 L11.81,16.19 L11.38,16.2
      L10.95,16.17 L10.52,16.09 L10.1,15.97 L9.69,15.81
      L9.29,15.6 L8.9,15.35 L8.54,15.06 L8.21,14.73 L7.91,14.37
      L7.65,13.97 L7.42,13.54 L7.24,13.09 L7.1,12.61 L7.01,12.12
      L6.97,11.62 L6.99,11.11 L7.05,10.6 L7.16,10.09 L7.33,9.6
      L7.55,9.11 L7.82,8.65 L8.13,8.21 L8.5,7.81 L8.9,7.43
      L9.35,7.1 L9.83,6.81 L10.35,6.57 L10.89,6.38 L11.45,6.24
      L12.03,6.16 L12.61,6.14 L13.21,6.18 L13.8,6.28 L14.38,6.44
      L14.95,6.66 L15.5,6.94 L16.02,7.27 L16.51,7.66 L16.96,8.1
      L17.37,8.58 L17.73,9.11 L18.04,9.68 L18.3,10.28
      L18.49,10.91 L18.62,11.56 L18.68,12.22 L18.68,12.9
      L18.61,13.57 L18.47,14.24 L18.26,14.9 L17.98,15.54
      L17.64,16.15 L17.24,16.72 L16.78,17.26 L16.26,17.76
      L15.69,18.2 L15.08,18.58 L14.42,18.91 L13.73,19.17
      L13.02,19.36 L12.28,19.48 L11.53,19.52 L10.77,19.49
      L10.02,19.38 L9.27,19.19 L8.54,18.93 L7.84,18.6 L7.17,18.19
      L6.54,17.71 L5.95,17.17 L5.42,16.58 L4.95,15.92 L4.55,15.22
      L4.21,14.48 L3.95,13.7 L3.77,12.89 L3.67,12.07 L3.65,11.23
      L3.72,10.39 L3.87,9.56 L4.11,8.74 L4.43,7.94 L4.82,7.17
      L5.3,6.45 L5.85,5.77 L6.47,5.15 L7.15,4.58 L7.89,4.09
      L8.68,3.67 L9.52,3.33 L10.39,3.07 L11.28,2.9 L12.19,2.82
      L13.12,2.84 L14.04,2.94 L14.95,3.14 L15.84,3.43 L16.7,3.81
      L17.53,4.28 L18.31,4.83 L19.03,5.46 L19.69,6.16 L20.28,6.93
      L20.79,7.76 L21.22,8.64 L21.56,9.56 L21.81,10.52
      L21.96,11.51" stroke="black" stroke-width=".75" fill="none"
      />
    </svg>
  </button>
</div>

 <!-- Graph Container -->
  <div id="graph-container" class="absolute inset-0 border-y md:border-x border-gray-200 md:rounded bg-white">
<div id="control-panel" style="display: none; position: fixed; top: 10px; right: 10px; background: white; border: 1px solid black; padding: 10px; z-index: 1000;">
    <button onclick="closePanel()" style="position: absolute; top: 5px; right: 5px;">X</button>
    <!-- Dynamic content will be inserted here -->
</div>    <svg id="graph-initial"></svg>
  </div>
  
  <!-- Loading spinner -->
  <div id="loading" class="absolute inset-0 flex items-center justify-center bg-white z-30">
    <svg class="animate-spin h-8 w-8 text-navy" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
    </svg>
  </div>
</div>
